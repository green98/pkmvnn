<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bản đồ Pokémon với Tooltips</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .scroll-container {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
            touch-action: pan-x pan-y;
        }
        
        .map-container {
            position: absolute;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
            transform-origin: center center;
        }
        
        .pokemon-map {
            display: block;
            max-width: none;
        }
        
        .hotspot {
            position: absolute;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s ease;
        }
        
        .hotspot:hover {
            transform: scale(1.05);
        }
        
        .tooltip {
            position: absolute;
            background-color: white;
            border: 2px solid #3a7ca5;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 20;
            width: 250px;
            transform-origin: center;
        }
        
        .tooltip img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }
        
        .tooltip-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #3a7ca5;
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            border-width: 8px;
            border-style: solid;
            border-color: #3a7ca5 transparent transparent transparent;
        }
        
        /* Các lớp định hướng cho tooltip */
        .tooltip-top {
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tooltip-top::after {
            top: 100%;
            left: 50%;
            margin-left: -8px;
        }
        
        .tooltip-bottom {
            top: 125%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tooltip-bottom::after {
            bottom: 100%;
            left: 50%;
            margin-left: -8px;
            border-color: transparent transparent #3a7ca5 transparent;
        }
        
        .tooltip-left {
            right: 125%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .tooltip-left::after {
            left: 100%;
            top: 50%;
            margin-top: -8px;
            border-color: transparent transparent transparent #3a7ca5;
        }
        
        .tooltip-right {
            left: 125%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .tooltip-right::after {
            right: 100%;
            top: 50%;
            margin-top: -8px;
            border-color: transparent #3a7ca5 transparent transparent;
        }
        
        .hotspot:hover .tooltip,
        .hotspot.active .tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        /* Pallet Town: 524,247 đến 542,264 */
        .pallet-town {
            left: 524px;
            top: 247px;
            width: 18px;
            height: 17px;
            background-color: rgba(255, 255, 0, 0.3);
            border-radius: 4px;
            border: 2px solid #ffcc00;
        }
        
        /* Viridian City: 510,181 đến 542,212 */
        .viridian-city {
            left: 510px;
            top: 181px;
            width: 32px;
            height: 31px;
            background-color: rgba(0, 255, 0, 0.3);
            border-radius: 4px;
            border: 2px solid #00cc00;
        }
        
        /* Thêm CSS cho nút điều khiển trên di động */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(58, 124, 165, 0.8);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        /* Media query cho thiết bị di động */
        @media (max-width: 768px) {
            .tooltip {
                width: 200px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="scroll-container" id="scrollContainer">
        <div class="map-container" id="mapContainer">
            <img src="https://z-cdn-media.chatglm.cn/files/4b6e3ec0-a391-4ecd-b245-962e9df96734_1.png?auth_key=1756023901-0aa5fcf7b7c248fe9c8ad6c00f77229b-0-813a0793d376ca7a347cb3eb32fb8e36" alt="Bản đồ Kanto" class="pokemon-map" id="pokemonMap">
            
            <!-- Pallet Town: 524,247 đến 542,264 -->
            <div class="hotspot pallet-town" data-location="Pallet Town">
                <div class="tooltip tooltip-top">
                    <div class="tooltip-title">Pallet Town</div>
                    <img src="https://wiki.pokemonrevolution.net/images/thumb/6/6b/Pallet_Town.png/600px-Pallet_Town.png" alt="Pallet Town">
                </div>
            </div>
            
            <!-- Viridian City: 510,181 đến 542,212 -->
            <div class="hotspot viridian-city" data-location="Viridian City">
                <div class="tooltip tooltip-top">
                    <div class="tooltip-title">Viridian City</div>
                    <img src="https://wiki.pokemonrevolution.net/images/thumb/9/9f/Viridian_City.png/600px-Viridian_City.png" alt="Viridian City">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Nút điều khiển zoom -->
    <div class="controls">
        <button class="control-btn" id="zoomIn">+</button>
        <button class="control-btn" id="zoomOut">-</button>
        <button class="control-btn" id="resetZoom">⟲</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scrollContainer = document.getElementById('scrollContainer');
            const mapContainer = document.getElementById('mapContainer');
            const pokemonMap = document.getElementById('pokemonMap');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const resetZoomBtn = document.getElementById('resetZoom');
            const hotspots = document.querySelectorAll('.hotspot');
            
            let scale = 1;
            let minScale = 0.5;
            let maxScale = 3;
            let isDragging = false;
            let startX, startY, scrollLeft, scrollTop;
            let activeHotspot = null;
            
            // Đặt vị trí ban đầu của bản đồ
            function initializeMap() {
                const containerWidth = window.innerWidth;
                const containerHeight = window.innerHeight;
                const mapWidth = pokemonMap.naturalWidth;
                const mapHeight = pokemonMap.naturalHeight;
                
                // Tính toán tỷ lệ để vừa màn hình
                const scaleX = containerWidth / mapWidth;
                const scaleY = containerHeight / mapHeight;
                const fitScale = Math.min(scaleX, scaleY) * 0.9; // Giảm 10% để có khoảng đệm
                
                scale = Math.max(minScale, Math.min(maxScale, fitScale));
                mapContainer.style.transform = `scale(${scale})`;
                
                // Căn giữa bản đồ
                const scaledWidth = mapWidth * scale;
                const scaledHeight = mapHeight * scale;
                mapContainer.style.left = `${(containerWidth - scaledWidth) / 2}px`;
                mapContainer.style.top = `${(containerHeight - scaledHeight) / 2}px`;
                
                // Cập nhật kích thước tooltip
                updateTooltipsScale();
            }
            
            // Cập nhật kích thước tooltip theo tỷ lệ zoom
            function updateTooltipsScale() {
                hotspots.forEach(hotspot => {
                    const tooltip = hotspot.querySelector('.tooltip');
                    if (tooltip) {
                        // Lưu kích thước gốc
                        if (!tooltip.dataset.originalWidth) {
                            tooltip.dataset.originalWidth = tooltip.offsetWidth;
                        }
                        
                        const originalWidth = parseFloat(tooltip.dataset.originalWidth);
                        const newWidth = originalWidth / scale;
                        
                        // Giới hạn kích thước tối thiểu và tối đa
                        const minTooltipWidth = 150;
                        const maxTooltipWidth = 300;
                        const clampedWidth = Math.max(minTooltipWidth, Math.min(maxTooltipWidth, newWidth));
                        
                        tooltip.style.width = `${clampedWidth}px`;
                        
                        // Điều chỉnh kích thước font chữ
                        const baseFontSize = 14;
                        const newFontSize = Math.max(12, Math.min(16, baseFontSize / scale));
                        tooltip.style.fontSize = `${newFontSize}px`;
                        
                        // Điều chỉnh padding
                        const basePadding = 10;
                        const newPadding = Math.max(5, Math.min(15, basePadding / scale));
                        tooltip.style.padding = `${newPadding}px`;
                        
                        // Điều chỉnh border radius
                        const baseBorderRadius = 8;
                        const newBorderRadius = Math.max(4, Math.min(12, baseBorderRadius / scale));
                        tooltip.style.borderRadius = `${newBorderRadius}px`;
                        
                        // Điều chỉnh kích thước mũi tên tooltip
                        const arrowSize = Math.max(5, Math.min(10, 8 / scale));
                        tooltip.style.setProperty('--arrow-size', `${arrowSize}px`);
                        
                        // Cập nhật lại CSS cho mũi tên
                        updateTooltipArrowSize(tooltip, arrowSize);
                    }
                });
            }
            
            // Cập nhật kích thước mũi tên tooltip
            function updateTooltipArrowSize(tooltip, arrowSize) {
                const styleSheet = document.styleSheets[0];
                const tooltipClasses = ['tooltip-top::after', 'tooltip-bottom::after', 'tooltip-left::after', 'tooltip-right::after'];
                
                tooltipClasses.forEach(selector => {
                    const rules = Array.from(styleSheet.cssRules).filter(rule => 
                        rule.selectorText && rule.selectorText.includes(selector)
                    );
                    
                    if (rules.length > 0) {
                        if (selector.includes('top') || selector.includes('bottom')) {
                            rules[0].style.borderTopWidth = `${arrowSize}px`;
                            rules[0].style.borderLeftWidth = `${arrowSize}px`;
                            rules[0].style.borderRightWidth = `${arrowSize}px`;
                            rules[0].style.marginLeft = `-${arrowSize}px`;
                        } else {
                            rules[0].style.borderTopWidth = `${arrowSize}px`;
                            rules[0].style.borderBottomWidth = `${arrowSize}px`;
                            rules[0].style.borderLeftWidth = `${arrowSize}px`;
                            rules[0].style.marginTop = `-${arrowSize}px`;
                        }
                    }
                });
            }
            
            // Điều chỉnh vị trí tooltip để không bị tràn ra ngoài màn hình
            function adjustTooltipPosition(tooltip, hotspot) {
                // Xóa tất cả các lớp định hướng
                tooltip.classList.remove('tooltip-top', 'tooltip-bottom', 'tooltip-left', 'tooltip-right');
                
                // Lấy thông tin vị trí và kích thước
                const hotspotRect = hotspot.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // Tính toán khoảng cách đến các cạnh
                const spaceTop = hotspotRect.top;
                const spaceBottom = viewportHeight - hotspotRect.bottom;
                const spaceLeft = hotspotRect.left;
                const spaceRight = viewportWidth - hotspotRect.right;
                
                // Xác định hướng hiển thị tốt nhất
                let bestPosition = 'top';
                let maxSpace = spaceTop;
                
                if (spaceBottom > maxSpace) {
                    maxSpace = spaceBottom;
                    bestPosition = 'bottom';
                }
                
                if (spaceLeft > maxSpace) {
                    maxSpace = spaceLeft;
                    bestPosition = 'left';
                }
                
                if (spaceRight > maxSpace) {
                    maxSpace = spaceRight;
                    bestPosition = 'right';
                }
                
                // Thêm lớp định hướng tương ứng
                tooltip.classList.add(`tooltip-${bestPosition}`);
                
                // Điều chỉnh vị trí nếu cần thiết
                setTimeout(() => {
                    const newTooltipRect = tooltip.getBoundingClientRect();
                    
                    // Nếu tooltip vẫn bị tràn ra ngoài, điều chỉnh thêm
                    if (bestPosition === 'top' || bestPosition === 'bottom') {
                        if (newTooltipRect.left < 0) {
                            tooltip.style.left = `${hotspotRect.left + hotspotRect.width / 2}px`;
                            tooltip.style.transform = 'translateX(-50%)';
                        } else if (newTooltipRect.right > viewportWidth) {
                            tooltip.style.left = `${hotspotRect.left + hotspotRect.width / 2 - (newTooltipRect.right - viewportWidth)}px`;
                            tooltip.style.transform = 'translateX(-50%)';
                        }
                    } else if (bestPosition === 'left' || bestPosition === 'right') {
                        if (newTooltipRect.top < 0) {
                            tooltip.style.top = `${hotspotRect.top + hotspotRect.height / 2}px`;
                            tooltip.style.transform = 'translateY(-50%)';
                        } else if (newTooltipRect.bottom > viewportHeight) {
                            tooltip.style.top = `${hotspotRect.top + hotspotRect.height / 2 - (newTooltipRect.bottom - viewportHeight)}px`;
                            tooltip.style.transform = 'translateY(-50%)';
                        }
                    }
                }, 10);
            }
            
            // Khởi tạo bản đồ khi tải trang
            pokemonMap.onload = initializeMap;
            if (pokemonMap.complete) {
                initializeMap();
            }
            
            // Xử lý sự kiện kéo lướt
            scrollContainer.addEventListener('mousedown', startDragging);
            scrollContainer.addEventListener('touchstart', startDragging);
            
            function startDragging(e) {
                isDragging = true;
                scrollContainer.style.cursor = 'grabbing';
                
                // Lấy vị trí bắt đầu
                if (e.type === 'touchstart') {
                    startX = e.touches[0].pageX - scrollContainer.offsetLeft;
                    startY = e.touches[0].pageY - scrollContainer.offsetTop;
                } else {
                    startX = e.pageX - scrollContainer.offsetLeft;
                    startY = e.pageY - scrollContainer.offsetTop;
                }
                
                scrollLeft = scrollContainer.scrollLeft;
                scrollTop = scrollContainer.scrollTop;
                
                // Ngăn chọn văn bản khi kéo
                e.preventDefault();
            }
            
            scrollContainer.addEventListener('mousemove', drag);
            scrollContainer.addEventListener('touchmove', drag);
            
            function drag(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                let x, y;
                if (e.type === 'touchmove') {
                    x = e.touches[0].pageX - scrollContainer.offsetLeft;
                    y = e.touches[0].pageY - scrollContainer.offsetTop;
                } else {
                    x = e.pageX - scrollContainer.offsetLeft;
                    y = e.pageY - scrollContainer.offsetTop;
                }
                
                const walkX = (x - startX) * 2; // Tăng tốc độ kéo
                const walkY = (y - startY) * 2;
                
                scrollContainer.scrollLeft = scrollLeft - walkX;
                scrollContainer.scrollTop = scrollTop - walkY;
            }
            
            scrollContainer.addEventListener('mouseup', stopDragging);
            scrollContainer.addEventListener('touchend', stopDragging);
            scrollContainer.addEventListener('mouseleave', stopDragging);
            
            function stopDragging() {
                isDragging = false;
                scrollContainer.style.cursor = 'grab';
            }
            
            // Xử lý phóng to/thu nhỏ
            zoomInBtn.addEventListener('click', function() {
                if (scale < maxScale) {
                    scale += 0.1;
                    mapContainer.style.transform = `scale(${scale})`;
                    updateTooltipsScale();
                    
                    // Nếu có tooltip đang hiển thị, cập nhật lại vị trí
                    if (activeHotspot) {
                        const tooltip = activeHotspot.querySelector('.tooltip');
                        if (tooltip) {
                            adjustTooltipPosition(tooltip, activeHotspot);
                        }
                    }
                }
            });
            
            zoomOutBtn.addEventListener('click', function() {
                if (scale > minScale) {
                    scale -= 0.1;
                    mapContainer.style.transform = `scale(${scale})`;
                    updateTooltipsScale();
                    
                    // Nếu có tooltip đang hiển thị, cập nhật lại vị trí
                    if (activeHotspot) {
                        const tooltip = activeHotspot.querySelector('.tooltip');
                        if (tooltip) {
                            adjustTooltipPosition(tooltip, activeHotspot);
                        }
                    }
                }
            });
            
            resetZoomBtn.addEventListener('click', function() {
                initializeMap();
            });
            
            // Xử lý xoay màn hình
            window.addEventListener('resize', function() {
                initializeMap();
                
                // Nếu có tooltip đang hiển thị, cập nhật lại vị trí
                if (activeHotspot) {
                    const tooltip = activeHotspot.querySelector('.tooltip');
                    if (tooltip) {
                        adjustTooltipPosition(tooltip, activeHotspot);
                    }
                }
            });
            
            // Xử lý sự kiện cuộn bằng chuột
            scrollContainer.addEventListener('wheel', function(e) {
                e.preventDefault();
                
                const delta = e.deltaY > 0 ? -0.1 : 0.1;
                const newScale = Math.max(minScale, Math.min(maxScale, scale + delta));
                
                if (newScale !== scale) {
                    scale = newScale;
                    mapContainer.style.transform = `scale(${scale})`;
                    updateTooltipsScale();
                    
                    // Nếu có tooltip đang hiển thị, cập nhật lại vị trí
                    if (activeHotspot) {
                        const tooltip = activeHotspot.querySelector('.tooltip');
                        if (tooltip) {
                            adjustTooltipPosition(tooltip, activeHotspot);
                        }
                    }
                }
            });
            
            // Xử lý tương tác với hotspot trên di động
            hotspots.forEach(hotspot => {
                // Xử lý click cho di động
                hotspot.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    const tooltip = hotspot.querySelector('.tooltip');
                    
                    // Nếu đã có hotspot đang active, đóng nó
                    if (activeHotspot && activeHotspot !== hotspot) {
                        activeHotspot.classList.remove('active');
                    }
                    
                    // Toggle trạng thái active của hotspot hiện tại
                    hotspot.classList.toggle('active');
                    
                    // Cập nhật hotspot đang active
                    activeHotspot = hotspot.classList.contains('active') ? hotspot : null;
                    
                    // Điều chỉnh vị trí tooltip nếu hiển thị
                    if (hotspot.classList.contains('active') && tooltip) {
                        adjustTooltipPosition(tooltip, hotspot);
                    }
                });
                
                // Xử lý hover cho desktop
                hotspot.addEventListener('mouseenter', function() {
                    if (window.innerWidth > 768) { // Chỉ áp dụng cho desktop
                        const tooltip = hotspot.querySelector('.tooltip');
                        hotspot.classList.add('active');
                        activeHotspot = hotspot;
                        
                        if (tooltip) {
                            adjustTooltipPosition(tooltip, hotspot);
                        }
                    }
                });
                
                hotspot.addEventListener('mouseleave', function() {
                    if (window.innerWidth > 768) { // Chỉ áp dụng cho desktop
                        hotspot.classList.remove('active');
                        activeHotspot = null;
                    }
                });
            });
            
            // Đóng tooltip khi click ra ngoài
            document.addEventListener('click', function() {
                if (activeHotspot) {
                    activeHotspot.classList.remove('active');
                    activeHotspot = null;
                }
            });
            
            // Ngăn sự kiện click lan tỏa từ hotspot
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            });
        });
    </script>
</body>
</html>