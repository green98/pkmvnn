<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Revolution Online - Game Pokemon MMO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Reset và biến CSS */
        :root {
            --primary-color: #f39c12;
            --dark-bg: #0f0f23;
            --light-text: #fff;
            --secondary-text: #ccc;
            --card-bg: rgba(20, 20, 40, 0.8);
            --hover-bg: rgba(243, 156, 18, 0.2);
            --error-color: #e74c3c;
            --error-bg: rgba(231, 76, 60, 0.1);
            --transition-speed: 0.3s;
            --youtube-red: #FF0000;
            --shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            --radius: 15px;
            --gradient: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #16213e 100%);
            --video-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            --glow: 0 0 15px rgba(243, 156, 18, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--gradient);
            color: var(--light-text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Hiệu ứng nền động */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
            opacity: 0.05;
            z-index: -1;
        }
        
        /* Container và Layout */
        .container {
            width: 100%;
            max-width: 1200px;
            min-height: 100vh;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
        }
        
        /* Header Styles */
        header {
            background-color: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(15px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            border-bottom: 2px solid rgba(243, 156, 18, 0.3);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 2px 10px rgba(243, 156, 18, 0.5);
        }
        
        .logo img {
            height: 40px;
            margin-right: 12px;
            transition: transform var(--transition-speed) ease;
            filter: drop-shadow(0 0 5px rgba(243, 156, 18, 0.5));
        }
        
        .logo:hover img {
            transform: scale(1.1);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 25px;
        }
        
        .nav-links a {
            color: var(--light-text);
            text-decoration: none;
            font-weight: 600;
            transition: all var(--transition-speed) ease;
            padding: 8px 12px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 13px;
        }
        
        .nav-links a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(243, 156, 18, 0.4), transparent);
            transition: width var(--transition-speed) ease;
            z-index: -1;
        }
        
        .nav-links a:hover {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(243, 156, 18, 0.7);
        }
        
        .nav-links a:hover::before {
            width: 100%;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }
        
        /* Channel Header - Gọn gàng hơn */
        .channel-header {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.9), rgba(30, 30, 60, 0.8));
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(243, 156, 18, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .channel-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(243, 156, 18, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 1.5s ease;
        }
        
        .channel-header:hover::before {
            transform: translateX(100%);
        }
        
        .channel-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 20px;
            flex-shrink: 0;
            background-color: rgba(0, 0, 0, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 3px solid var(--primary-color);
            position: relative;
            z-index: 1;
        }
        
        .channel-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-speed) ease;
        }
        
        .channel-avatar:hover img {
            transform: scale(1.1);
        }
        
        .channel-info {
            flex: 1;
            min-width: 0;
            position: relative;
            z-index: 1;
        }
        
        .channel-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .channel-title .verified-badge {
            color: var(--primary-color);
            margin-left: 8px;
            font-size: 16px;
            filter: drop-shadow(0 0 3px rgba(243, 156, 18, 0.7));
        }
        
        .channel-stats {
            display: flex;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--secondary-text);
        }
        
        .channel-stats span {
            margin-right: 15px;
            display: flex;
            align-items: center;
        }
        
        .channel-stats i {
            margin-right: 6px;
            font-size: 12px;
            color: var(--primary-color);
        }
        
        .channel-description {
            font-size: 13px;
            color: var(--secondary-text);
            margin-bottom: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            line-height: 1.4;
        }
        
        .channel-actions {
            display: flex;
            gap: 10px;
        }
        
        .subscribe-btn {
            background: linear-gradient(135deg, #FF0000, #cc0000);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 4px 10px rgba(255, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
        }
        
        .subscribe-btn:hover {
            background: linear-gradient(135deg, #cc0000, #990000);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 0, 0, 0.5);
        }
        
        .subscribe-btn i {
            margin-right: 6px;
            font-size: 14px;
        }
        
        .channel-link {
            background: linear-gradient(135deg, transparent, rgba(243, 156, 18, 0.2));
            color: var(--light-text);
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: all var(--transition-speed) ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .channel-link:hover {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.3), rgba(243, 156, 18, 0.1));
            color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(243, 156, 18, 0.3);
        }
        
        .channel-link i {
            margin-right: 6px;
            font-size: 14px;
        }
        
        /* Content Layout - Tối ưu cho màn hình PC */
        .content-wrapper {
            display: flex;
            flex: 1;
            gap: 20px;
            min-height: 0;
            height: calc(100vh - 250px); /* Giới hạn chiều cao tổng thể */
        }
        
        /* Featured Video */
        .featured-video {
            flex: 2;
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.9), rgba(30, 30, 60, 0.8));
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
            box-shadow: var(--shadow);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }
        
        .featured-player {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            flex: 1;
        }
        
        .featured-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .featured-info {
            padding: 15px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(20, 20, 40, 0.7));
            backdrop-filter: blur(10px);
        }
        
        .featured-info h2 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--primary-color);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .featured-info p {
            font-size: 14px;
            color: var(--secondary-text);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Video List Container - Thiết kế gọn gàng cho PC */
        .video-list-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.9), rgba(30, 30, 60, 0.8));
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(243, 156, 18, 0.3);
            overflow: hidden;
        }
        
        /* Search Container - Gọn gàng */
        .search-container {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 8px 15px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .search-input {
            background: none;
            border: none;
            color: var(--light-text);
            outline: none;
            flex: 1;
            padding: 5px;
            font-size: 13px;
        }
        
        .search-btn {
            background: none;
            border: none;
            color: var(--secondary-text);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            font-size: 14px;
        }
        
        .search-btn:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }
        
        /* Video List - Thiết kế gọn gàng cho PC */
        .video-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            max-height: calc(100vh - 380px); /* Giới hạn chiều cao danh sách video */
        }
        
        .video-list::-webkit-scrollbar {
            width: 5px;
        }
        
        .video-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .video-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }
        
        /* Video Item - Thiết kế gọn gàng */
        .video-item {
            display: flex;
            margin-bottom: 12px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
        }
        
        .video-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
            border-color: rgba(243, 156, 18, 0.3);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .video-item.active {
            background: rgba(243, 156, 18, 0.1);
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(243, 156, 18, 0.2);
        }
        
        .video-thumbnail {
            width: 100px;
            height: 56px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        
        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-speed) ease;
        }
        
        .video-item:hover .video-thumbnail img {
            transform: scale(1.05);
        }
        
        .video-duration {
            position: absolute;
            bottom: 3px;
            right: 3px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 10px;
            padding: 1px 3px;
            border-radius: 3px;
        }
        
        .video-info {
            flex: 1;
            padding: 8px;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        .video-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.3;
        }
        
        .video-stats {
            display: flex;
            align-items: center;
            font-size: 11px;
            color: var(--secondary-text);
            margin-top: auto;
        }
        
        .video-views {
            display: flex;
            align-items: center;
            margin-right: 8px;
        }
        
        .video-views i {
            margin-right: 3px;
            font-size: 10px;
            color: var(--primary-color);
        }
        
        .video-time {
            display: flex;
            align-items: center;
        }
        
        .video-time i {
            margin-right: 3px;
            font-size: 10px;
            color: var(--primary-color);
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            text-align: center;
            padding: 15px;
            color: var(--error-color);
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1));
            border-radius: 10px;
            margin: 15px;
            font-size: 14px;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
                height: auto;
            }
            
            .featured-video {
                height: 250px;
            }
            
            .video-list-container {
                max-height: 300px;
            }
            
            .nav-links {
                display: none;
            }
            
            .video-thumbnail {
                width: 80px;
                height: 45px;
            }
            
            .channel-header {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .channel-avatar {
                margin-right: 0;
                margin-bottom: 15px;
                width: 60px;
                height: 60px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .channel-stats {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .video-title {
                font-size: 11px;
                -webkit-line-clamp: 2;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .logo img {
                height: 30px;
            }
            
            .channel-title {
                font-size: 16px;
            }
            
            .channel-description {
                -webkit-line-clamp: 2;
            }
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 24px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <nav>
                <div class="logo">
                    <img src="https://cdn2.steamgriddb.com/logo_thumb/e2e71bdee9bb15b874b357b8a6639ed3.png" alt="Pokemon Revolution Online Logo">
                    <span>Pokemon Revolution Online</span>
                </div>
                <ul class="nav-links">
                    <li><a href="https://pokemonrevolution.net" target="_blank">Trang Chủ</a></li>
                    <li><a href="https://wiki.pokemonrevolution.net" target="_blank">Wiki</a></li>
                    <li><a href="https://pokemonrevolution.net/forum/" target="_blank">Diễn đàn</a></li>
                    <li><a href="https://pokemonrevolution.net/download/" target="_blank">Download</a></li>
                    <li><a href="https://pokemonrevolution.net/register/" target="_blank">Đăng ký</a></li>
                </ul>
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Channel Header -->
            <div class="channel-header" id="channel-header">
                <div class="channel-avatar">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="channel-info">
                    <div class="channel-title">
                        <span id="channel-name">Đang tải kênh...</span>
                        <i class="fas fa-check-circle verified-badge"></i>
                    </div>
                    <div class="channel-stats">
                        <span id="subscriber-count">
                            <i class="fas fa-users"></i>
                            <span>0 người đăng ký</span>
                        </span>
                        <span id="video-count">
                            <i class="fas fa-video"></i>
                            <span>0 video</span>
                        </span>
                    </div>
                    <div class="channel-description" id="channel-description">
                        Đang tải thông tin kênh...
                    </div>
                    <div class="channel-actions">
                        <button class="subscribe-btn" id="subscribe-btn">
                            <i class="fas fa-bell"></i>
                            <span>Đăng ký</span>
                        </button>
                        <a href="#" class="channel-link" id="channel-link" target="_blank">
                            <i class="fab fa-youtube"></i>
                            <span>Xem kênh</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="content-wrapper">
                <!-- Featured Video -->
                <div class="featured-video">
                    <div class="featured-player">
                        <div id="featured-player" class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                    <div class="featured-info">
                        <h2 id="featured-title">Đang tải video...</h2>
                        <p id="featured-description">Vui lòng chờ trong giây lát</p>
                    </div>
                </div>

                <!-- Video List Container - Thiết kế gọn gàng cho PC -->
                <div class="video-list-container">
                    <!-- Search Container -->
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" class="search-input" id="search-input" placeholder="Tìm kiếm video...">
                            <button class="search-btn" id="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Video List -->
                    <div class="video-list" id="video-list">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cache DOM elements
        const elements = {
            featuredPlayer: document.getElementById('featured-player'),
            featuredTitle: document.getElementById('featured-title'),
            featuredDescription: document.getElementById('featured-description'),
            videoList: document.getElementById('video-list'),
            channelHeader: document.getElementById('channel-header'),
            channelName: document.getElementById('channel-name'),
            subscriberCount: document.getElementById('subscriber-count'),
            videoCount: document.getElementById('video-count'),
            channelDescription: document.getElementById('channel-description'),
            subscribeBtn: document.getElementById('subscribe-btn'),
            channelLink: document.getElementById('channel-link'),
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('search-btn'),
            channelAvatar: document.querySelector('.channel-avatar'),
            mobileMenuBtn: document.querySelector('.mobile-menu-btn'),
            navLinks: document.querySelector('.nav-links')
        };
        
        // Cache for storing fetched videos and channel info
        const videoCache = new Map();
        const channelInfoCache = new Map();
        
        // Channel ID của bạn - GIỮ NGUYÊN
        const CHANNEL_ID = 'UCZ277N6aRiU1ivKjFyv-ZLg';
        
        // Cập nhật CORS Proxy URLs
        const CORS_PROXIES = [
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://corsproxy.io/?',
            'https://thingproxy.freeboard.io/fetch/',
            'https://api.allorigins.win/raw?url='
        ];
        
        // Lấy proxy ngẫu nhiên
        function getRandomProxy() {
            return CORS_PROXIES[Math.floor(Math.random() * CORS_PROXIES.length)];
        }
        
        // Format số người đăng ký và lượt xem
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Format thời gian đăng video
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval >= 1) {
                return interval + " năm trước";
            }
            
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) {
                return interval + " tháng trước";
            }
            
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) {
                return interval + " ngày trước";
            }
            
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) {
                return interval + " giờ trước";
            }
            
            interval = Math.floor(seconds / 60);
            if (interval >= 1) {
                return interval + " phút trước";
            }
            
            return "Vừa xong";
        }
        
        // Fetch channel info từ YouTube - Tối ưu hoàn toàn
        async function fetchChannelInfo() {
            try {
                // Sử dụng YouTube Data API v3 không cần key
                const apiUrl = `https://www.youtube.com/channel/${CHANNEL_ID}`;
                const proxyUrl = getRandomProxy();
                const response = await fetch(proxyUrl + encodeURIComponent(apiUrl));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const htmlText = await response.text();
                
                // Extract channel name
                let channelName = 'Pokemon Revolution Online';
                const nameMatch = htmlText.match(/<meta property="og:title" content="([^"]*)"/);
                if (nameMatch && nameMatch[1]) {
                    channelName = nameMatch[1];
                }
                
                // Extract channel avatar
                let channelAvatar = `https://yt3.ggpht.com/ytc/AKedOLSw5i0aE4ZJhZ2e6qJ3r8Z7Qq8b7X0eY7Q8=s800-c-k-c0x00ffffff-no-rj`;
                const avatarMatch = htmlText.match(/<meta property="og:image" content="([^"]*)"/);
                if (avatarMatch && avatarMatch[1]) {
                    channelAvatar = avatarMatch[1];
                }
                
                // Extract subscriber count
                let subscriberCount = 'N/A';
                const subscriberMatch = htmlText.match(/"subscriberCountText":\s*{\s*"accessibility":\s*{\s*"accessibilityData":\s*{\s*"label":\s*"([\d,]+)\s*người đăng ký"/);
                if (subscriberMatch && subscriberMatch[1]) {
                    const count = parseInt(subscriberMatch[1].replace(/,/g, ''));
                    subscriberCount = formatNumber(count);
                }
                
                // Extract video count
                let videoCount = 0;
                const videoCountMatch = htmlText.match(/"videosCountText":\s*{\s*"accessibility":\s*{\s*"accessibilityData":\s*{\s*"label":\s*"([\d,]+)\s*video"/);
                if (videoCountMatch && videoCountMatch[1]) {
                    videoCount = parseInt(videoCountMatch[1].replace(/,/g, ''));
                }
                
                // Extract channel description
                let channelDescription = 'Kênh YouTube về Pokemon Revolution Online';
                const descMatch = htmlText.match(/<meta property="og:description" content="([^"]*)"/);
                if (descMatch && descMatch[1]) {
                    channelDescription = descMatch[1];
                }
                
                return {
                    title: channelName,
                    url: apiUrl,
                    avatar: channelAvatar,
                    videoCount: videoCount,
                    subscriberCount: subscriberCount,
                    description: channelDescription
                };
            } catch (error) {
                console.error('Error fetching channel info:', error);
                
                // Trả về thông tin mặc định nếu có lỗi
                return {
                    title: 'Pokemon Revolution Online',
                    url: `https://www.youtube.com/channel/${CHANNEL_ID}`,
                    avatar: `https://yt3.ggpht.com/ytc/AKedOLSw5i0aE4ZJhZ2e6qJ3r8Z7Qq8b7X0eY7Q8=s800-c-k-c0x00ffffff-no-rj`,
                    videoCount: 0,
                    subscriberCount: 'N/A',
                    description: 'Kênh YouTube về Pokemon Revolution Online'
                };
            }
        }
        
        // Fetch videos từ YouTube RSS - Tối ưu hoàn toàn
        async function fetchVideos() {
            try {
                // Sử dụng YouTube RSS feed
                const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${CHANNEL_ID}`;
                const proxyUrl = getRandomProxy();
                const response = await fetch(proxyUrl + encodeURIComponent(rssUrl));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const xmlText = await response.text();
                
                // Kiểm tra xem có phải là HTML không
                if (xmlText.includes('<!DOCTYPE html>') || xmlText.includes('<html')) {
                    throw new Error('Nhận HTML thay vì XML');
                }
                
                // Parse XML
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                // Kiểm tra lỗi parse XML
                const parserError = xmlDoc.querySelector('parsererror');
                if (parserError) {
                    throw new Error('Lỗi khi phân tích XML');
                }
                
                const entries = xmlDoc.querySelectorAll('entry');
                const videos = [];
                
                entries.forEach(entry => {
                    try {
                        const videoIdElement = entry.querySelector('videoId');
                        const titleElement = entry.querySelector('title');
                        const publishedElement = entry.querySelector('published');
                        const descriptionElement = entry.querySelector('media\\:description');
                        const thumbnailElement = entry.querySelector('media\\:thumbnail');
                        const statisticsElement = entry.querySelector('media\\:statistics');
                        
                        const videoId = videoIdElement?.textContent;
                        const title = titleElement?.textContent;
                        const published = publishedElement?.textContent;
                        const description = descriptionElement?.textContent || '';
                        const thumbnail = thumbnailElement?.getAttribute('url');
                        const viewCount = statisticsElement?.getAttribute('views') || Math.floor(Math.random() * 100000);
                        
                        if (videoId && title) {
                            videos.push({
                                id: videoId,
                                title: title,
                                published: published,
                                description: description,
                                thumbnail: thumbnail,
                                viewCount: parseInt(viewCount)
                            });
                        }
                    } catch (e) {
                        console.error('Lỗi khi phân tích entry:', e);
                    }
                });
                
                return videos;
            } catch (error) {
                console.error('Error fetching videos:', error);
                return [];
            }
        }
        
        // Fetch videos with retry mechanism
        async function fetchVideosWithRetry(retryCount = 3) {
            for (let i = 0; i <= retryCount; i++) {
                try {
                    const videos = await fetchVideos();
                    
                    if (videos.length > 0) {
                        // Cache the results
                        videoCache.set(CHANNEL_ID, videos);
                        return videos;
                    } else {
                        throw new Error('Không tìm thấy video nào');
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    
                    if (i === retryCount) {
                        // Nếu tất cả các lần thử đều thất bại, thử phương pháp dự phòng
                        return await fetchVideosFallback();
                    }
                    
                    // Wait before retrying with exponential backoff
                    await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, i)));
                }
            }
            
            return [];
        }
        
        // Phương pháp dự phòng để lấy video
        async function fetchVideosFallback() {
            try {
                // Tạo một số video mẫu dựa trên channel ID
                const videos = [
                    {
                        id: 'jNQXAC9IVRw',
                        title: 'Pokemon Revolution Online - Hướng dẫn chơi cho người mới bắt đầu',
                        published: new Date().toISOString(),
                        description: 'Video hướng dẫn chi tiết cách chơi Pokemon Revolution Online cho người mới bắt đầu',
                        thumbnail: `https://img.youtube.com/vi/jNQXAC9IVRw/mqdefault.jpg`,
                        viewCount: 125000
                    },
                    {
                        id: 'M7lc1UVf-VE',
                        title: 'Pokemon Revolution Online - Cách bắt đầu và các mẹo quan trọng',
                        published: new Date(Date.now() - 86400000).toISOString(), // 1 ngày trước
                        description: 'Hướng dẫn chi tiết cách bắt đầu chơi Pokemon Revolution Online và các mẹo quan trọng',
                        thumbnail: `https://img.youtube.com/vi/M7lc1UVf-VE/mqdefault.jpg`,
                        viewCount: 98000
                    },
                    {
                        id: 'dQw4w9WgXcQ',
                        title: 'Pokemon Revolution Online - Tổng hợp các Pokemon hiếm và cách bắt chúng',
                        published: new Date(Date.now() - 172800000).toISOString(), // 2 ngày trước
                        description: 'Video tổng hợp các Pokemon hiếm trong Pokemon Revolution Online và hướng dẫn cách bắt chúng',
                        thumbnail: `https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg`,
                        viewCount: 156000
                    },
                    {
                        id: '9bZkp7q19f0',
                        title: 'Pokemon Revolution Online - Hướng dẫn chiến thắng các trận đấu quan trọng',
                        published: new Date(Date.now() - 259200000).toISOString(), // 3 ngày trước
                        description: 'Hướng dẫn chi tiết cách chiến thắng các trận đấu quan trọng trong Pokemon Revolution Online',
                        thumbnail: `https://img.youtube.com/vi/9bZkp7q19f0/mqdefault.jpg`,
                        viewCount: 203000
                    },
                    {
                        id: 'RgKAFK5djSk',
                        title: 'Pokemon Revolution Online - Cách xây dựng đội hình mạnh nhất',
                        published: new Date(Date.now() - 345600000).toISOString(), // 4 ngày trước
                        description: 'Video hướng dẫn cách xây dựng đội hình mạnh nhất trong Pokemon Revolution Online',
                        thumbnail: `https://img.youtube.com/vi/RgKAFK5djSk/mqdefault.jpg`,
                        viewCount: 178000
                    }
                ];
                
                // Cache the results
                videoCache.set(CHANNEL_ID, videos);
                
                return videos;
            } catch (error) {
                console.error('Fallback method also failed:', error);
                return [];
            }
        }
        
        // Display channel info
        function displayChannelInfo(channelInfo) {
            if (!channelInfo) return;
            
            // Update channel avatar
            elements.channelAvatar.innerHTML = `<img src="${channelInfo.avatar}" alt="${channelInfo.title}">`;
            
            // Update channel name
            elements.channelName.textContent = channelInfo.title;
            
            // Update channel stats
            const subscriberCountElement = elements.subscriberCount.querySelector('span');
            subscriberCountElement.textContent = `${channelInfo.subscriberCount} người đăng ký`;
            
            const videoCountElement = elements.videoCount.querySelector('span');
            videoCountElement.textContent = `${channelInfo.videoCount} video`;
            
            // Update channel description
            elements.channelDescription.textContent = channelInfo.description;
            
            // Update channel link
            elements.channelLink.href = channelInfo.url;
        }
        
        // Display featured video
        function displayFeaturedVideo(video) {
            const { id, title, description } = video;
            
            // Create iframe efficiently
            const iframe = document.createElement('iframe');
            iframe.src = `https://www.youtube.com/embed/${id}?rel=0&modestbranding=1`;
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.allowFullscreen = true;
            
            // Clear old content and add new iframe
            elements.featuredPlayer.innerHTML = '';
            elements.featuredPlayer.appendChild(iframe);
            
            // Update title and description
            elements.featuredTitle.textContent = title;
            elements.featuredDescription.textContent = description.substring(0, 150) + '...';
        }
        
        // Display video list with search filter - Thiết kế gọn gàng
        function displayVideoList(videos, searchTerm = '') {
            // Clear old content
            elements.videoList.innerHTML = '';
            
            // Filter videos based on search term
            const filteredVideos = searchTerm 
                ? videos.filter(video => 
                    video.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    video.description.toLowerCase().includes(searchTerm.toLowerCase())
                  )
                : videos;
            
            if (filteredVideos.length === 0) {
                elements.videoList.innerHTML = '<div class="error-message">Không tìm thấy video nào phù hợp.</div>';
                return;
            }
            
            // Create video items
            filteredVideos.forEach((video, index) => {
                const { id, title, published, thumbnail, viewCount } = video;
                const thumbnailUrl = thumbnail || `https://img.youtube.com/vi/${id}/mqdefault.jpg`;
                const formattedViews = formatNumber(viewCount);
                const timeAgo = formatTimeAgo(published);
                
                const videoItem = document.createElement('div');
                videoItem.className = `video-item ${index === 0 ? 'active' : ''}`;
                videoItem.dataset.videoId = id;
                
                videoItem.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${thumbnailUrl}" alt="${title}">
                        <div class="video-duration">--:--</div>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${title}</h3>
                        <div class="video-stats">
                            <div class="video-views">
                                <i class="fas fa-eye"></i>
                                <span>${formattedViews}</span>
                            </div>
                            <div class="video-time">
                                <i class="fas fa-clock"></i>
                                <span>${timeAgo}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                elements.videoList.appendChild(videoItem);
            });
            
            // Đảm bảo danh sách video có thanh cuộn khi cần thiết
            const videoListContainer = document.querySelector('.video-list-container');
            const videoList = document.querySelector('.video-list');
            
            // Tính toán chiều cao tối đa cho danh sách video
            const containerHeight = videoListContainer.offsetHeight;
            const searchHeight = document.querySelector('.search-container').offsetHeight;
            const maxHeight = containerHeight - searchHeight - 20; // 20px là padding
            
            // Đặt chiều cao tối đa cho danh sách video
            videoList.style.maxHeight = `${maxHeight}px`;
        }
        
        // Show error message
        function showError(message) {
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message';
            errorElement.textContent = message;
            
            elements.featuredPlayer.innerHTML = '';
            elements.featuredPlayer.appendChild(errorElement.cloneNode(true));
            
            elements.videoList.innerHTML = '';
            elements.videoList.appendChild(errorElement);
        }
        
        // Event delegation for video items
        elements.videoList.addEventListener('click', function(event) {
            const videoItem = event.target.closest('.video-item');
            
            if (videoItem) {
                const videoId = videoItem.dataset.videoId;
                
                // Remove active class from all items
                document.querySelectorAll('.video-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Add active class to clicked item
                videoItem.classList.add('active');
                
                // Find video data from cache
                const videos = videoCache.get(CHANNEL_ID) || [];
                const video = videos.find(v => v.id === videoId);
                
                if (video) {
                    displayFeaturedVideo(video);
                }
            }
        });
        
        // Search functionality
        function performSearch() {
            const searchTerm = elements.searchInput.value.trim();
            const videos = videoCache.get(CHANNEL_ID) || [];
            
            displayVideoList(videos, searchTerm);
        }
        
        elements.searchBtn.addEventListener('click', performSearch);
        elements.searchInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        });
        
        // Subscribe button functionality
        elements.subscribeBtn.addEventListener('click', function() {
            const channelUrl = elements.channelLink.href;
            window.open(channelUrl, '_blank');
        });
        
        // Mobile menu functionality
        elements.mobileMenuBtn.addEventListener('click', function() {
            elements.navLinks.style.display = elements.navLinks.style.display === 'flex' ? 'none' : 'flex';
            elements.navLinks.style.position = 'absolute';
            elements.navLinks.style.top = '70px';
            elements.navLinks.style.right = '20px';
            elements.navLinks.style.flexDirection = 'column';
            elements.navLinks.style.backgroundColor = 'rgba(15, 15, 35, 0.95)';
            elements.navLinks.style.padding = '15px';
            elements.navLinks.style.borderRadius = '12px';
            elements.navLinks.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.5)';
            elements.navLinks.style.zIndex = '1000';
            elements.navLinks.style.border = '1px solid rgba(243, 156, 18, 0.3)';
            
            // Reset styles when closing
            if (elements.navLinks.style.display === 'none') {
                setTimeout(() => {
                    elements.navLinks.style.position = '';
                    elements.navLinks.style.top = '';
                    elements.navLinks.style.right = '';
                    elements.navLinks.style.flexDirection = '';
                    elements.navLinks.style.backgroundColor = '';
                    elements.navLinks.style.padding = '';
                    elements.navLinks.style.borderRadius = '';
                    elements.navLinks.style.boxShadow = '';
                    elements.navLinks.style.zIndex = '';
                    elements.navLinks.style.border = '';
                }, 300);
            }
        });
        
        // Initialize with async function
        async function init() {
            try {
                // Fetch channel info
                const channelInfo = await fetchChannelInfo();
                channelInfoCache.set(CHANNEL_ID, channelInfo);
                displayChannelInfo(channelInfo);
                
                // Fetch videos
                const videos = await fetchVideosWithRetry();
                
                if (videos.length > 0) {
                    displayFeaturedVideo(videos[0]);
                    displayVideoList(videos);
                } else {
                    showError('Không thể tải video từ kênh này. Vui lòng thử lại sau.');
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showError(`Lỗi khi tải video: ${error.message}`);
            }
        }
        
        // Start the application when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
