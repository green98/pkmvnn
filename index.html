<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Revolution Online - Game Pokemon MMO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Reset và biến CSS */
        :root {
            --primary-color: #f39c12;
            --dark-bg: #0f0f23;
            --light-text: #fff;
            --secondary-text: #ccc;
            --card-bg: rgba(20, 20, 40, 0.7);
            --hover-bg: rgba(243, 156, 18, 0.15);
            --error-color: #e74c3c;
            --error-bg: rgba(231, 76, 60, 0.1);
            --transition-speed: 0.3s;
            --youtube-red: #FF0000;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            --radius: 12px;
            --gradient: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--gradient);
            color: var(--light-text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Container và Layout */
        .container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header Styles */
        header {
            background-color: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .logo img {
            height: 40px;
            margin-right: 12px;
            transition: transform var(--transition-speed) ease;
        }
        
        .logo:hover img {
            transform: scale(1.05);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 25px;
        }
        
        .nav-links a {
            color: var(--light-text);
            text-decoration: none;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
            padding: 8px 12px;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }
        
        .nav-links a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: var(--hover-bg);
            transition: width var(--transition-speed) ease;
            z-index: -1;
        }
        
        .nav-links a:hover {
            color: var(--primary-color);
        }
        
        .nav-links a:hover::before {
            width: 100%;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Channel Header */
        .channel-header {
            display: flex;
            align-items: center;
            background-color: var(--card-bg);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .channel-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 25px;
            flex-shrink: 0;
            background-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            border: 3px solid var(--primary-color);
        }
        
        .channel-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-speed) ease;
        }
        
        .channel-avatar:hover img {
            transform: scale(1.05);
        }
        
        .channel-info {
            flex: 1;
            min-width: 0;
        }
        
        .channel-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .channel-title .verified-badge {
            color: var(--primary-color);
            margin-left: 10px;
            font-size: 20px;
        }
        
        .channel-stats {
            display: flex;
            margin-bottom: 12px;
            font-size: 15px;
            color: var(--secondary-text);
        }
        
        .channel-stats span {
            margin-right: 20px;
            display: flex;
            align-items: center;
        }
        
        .channel-stats i {
            margin-right: 8px;
            font-size: 14px;
            color: var(--primary-color);
        }
        
        .channel-description {
            font-size: 15px;
            color: var(--secondary-text);
            margin-bottom: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.5;
        }
        
        .channel-actions {
            display: flex;
            gap: 12px;
        }
        
        .subscribe-btn {
            background-color: var(--youtube-red);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
        }
        
        .subscribe-btn:hover {
            background-color: #cc0000;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 0, 0, 0.4);
        }
        
        .subscribe-btn i {
            margin-right: 8px;
        }
        
        .channel-link {
            background-color: transparent;
            color: var(--light-text);
            border: 1px solid var(--primary-color);
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: all var(--transition-speed) ease;
        }
        
        .channel-link:hover {
            background-color: var(--hover-bg);
            color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .channel-link i {
            margin-right: 8px;
        }
        
        /* Search Container */
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--card-bg);
            border-radius: 30px;
            padding: 8px 20px;
            width: 350px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .search-input {
            background: none;
            border: none;
            color: var(--light-text);
            outline: none;
            flex: 1;
            padding: 8px;
            font-size: 15px;
        }
        
        .search-btn {
            background: none;
            border: none;
            color: var(--secondary-text);
            cursor: pointer;
            transition: color var(--transition-speed) ease;
            font-size: 16px;
        }
        
        .search-btn:hover {
            color: var(--primary-color);
        }
        
        /* Content Layout */
        .content-wrapper {
            display: flex;
            flex: 1;
            gap: 20px;
            min-height: 0; /* Quan trọng cho flex container */
        }
        
        /* Featured Video */
        .featured-video {
            flex: 2;
            background-color: var(--card-bg);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Quan trọng cho flex container */
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .featured-player {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* Tỷ lệ 16:9 */
            height: 0;
            overflow: hidden;
            flex: 1;
        }
        
        .featured-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .featured-info {
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .featured-info h2 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--primary-color);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .featured-info p {
            font-size: 14px;
            color: var(--secondary-text);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Video List */
        .video-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            padding-right: 5px;
            min-height: 0; /* Quan trọng cho flex container */
            max-height: calc(100vh - 280px); /* Giới hạn chiều cao để scroll được */
        }
        
        .video-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .video-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .video-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }
        
        /* Video Item */
        .video-item {
            display: flex;
            background-color: var(--card-bg);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            will-change: transform;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .video-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: var(--primary-color);
        }
        
        .video-item.active {
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.3);
        }
        
        .video-thumbnail {
            width: 140px;
            height: 80px;
            position: relative;
            flex-shrink: 0;
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease, transform var(--transition-speed) ease;
        }
        
        .video-thumbnail img.loaded {
            opacity: 1;
        }
        
        .video-item:hover .video-thumbnail img {
            transform: scale(1.05);
        }
        
        .video-duration {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .video-info {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 0;
        }
        
        .video-info h3 {
            font-size: 15px;
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.4;
        }
        
        .video-info p {
            font-size: 13px;
            color: var(--secondary-text);
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            text-align: center;
            padding: 20px;
            color: var(--error-color);
            background-color: var(--error-bg);
            border-radius: 10px;
            margin: 15px 0;
            font-size: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .featured-video {
                height: 300px; /* Chiều cao cố định cho mobile */
            }
            
            .video-list {
                flex: 1;
                max-height: 400px; /* Giới hạn chiều cao để scroll được trên mobile */
            }
            
            .nav-links {
                display: none;
            }
            
            .video-thumbnail {
                width: 120px;
                height: 70px;
            }
            
            .channel-header {
                flex-direction: column;
                text-align: center;
            }
            
            .channel-avatar {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .search-box {
                width: 100%;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .channel-stats {
                justify-content: center;
            }
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 24px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <nav>
                <div class="logo">
                    <img src="https://cdn2.steamgriddb.com/logo_thumb/e2e71bdee9bb15b874b357b8a6639ed3.png" alt="Pokemon Revolution Online Logo">
                    <span>Pokemon Revolution Online</span>
                </div>
                <ul class="nav-links">
                    <li><a href="https://pokemonrevolution.net" target="_blank">Trang Chủ</a></li>
                    <li><a href="https://wiki.pokemonrevolution.net" target="_blank">Wiki</a></li>
                    <li><a href="https://pokemonrevolution.net/forum/" target="_blank">Diễn đàn</a></li>
                    <li><a href="https://pokemonrevolution.net/download/" target="_blank">Download</a></li>
                    <li><a href="https://pokemonrevolution.net/register/" target="_blank">Đăng ký</a></li>
                </ul>
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Channel Header -->
            <div class="channel-header" id="channel-header">
                <div class="channel-avatar">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="channel-info">
                    <div class="channel-title">
                        <span id="channel-name">Đang tải kênh...</span>
                        <i class="fas fa-check-circle verified-badge"></i>
                    </div>
                    <div class="channel-stats">
                        <span id="subscriber-count">
                            <i class="fas fa-users"></i>
                            <span>0 người đăng ký</span>
                        </span>
                        <span id="video-count">
                            <i class="fas fa-video"></i>
                            <span>0 video</span>
                        </span>
                    </div>
                    <div class="channel-description" id="channel-description">
                        Đang tải thông tin kênh...
                    </div>
                    <div class="channel-actions">
                        <button class="subscribe-btn" id="subscribe-btn">
                            <i class="fas fa-bell"></i>
                            <span>Đăng ký</span>
                        </button>
                        <a href="#" class="channel-link" id="channel-link" target="_blank">
                            <i class="fab fa-youtube"></i>
                            <span>Xem kênh</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Search Container -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" placeholder="Tìm kiếm video...">
                    <button class="search-btn" id="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <div class="content-wrapper">
                <!-- Featured Video -->
                <div class="featured-video">
                    <div class="featured-player">
                        <div id="featured-player" class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                    <div class="featured-info">
                        <h2 id="featured-title">Đang tải video...</h2>
                        <p id="featured-description">Vui lòng chờ trong giây lát</p>
                    </div>
                </div>

                <!-- Video List -->
                <div class="video-list" id="video-list">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cache DOM elements
        const elements = {
            featuredPlayer: document.getElementById('featured-player'),
            featuredTitle: document.getElementById('featured-title'),
            featuredDescription: document.getElementById('featured-description'),
            videoList: document.getElementById('video-list'),
            channelHeader: document.getElementById('channel-header'),
            channelName: document.getElementById('channel-name'),
            subscriberCount: document.getElementById('subscriber-count'),
            videoCount: document.getElementById('video-count'),
            channelDescription: document.getElementById('channel-description'),
            subscribeBtn: document.getElementById('subscribe-btn'),
            channelLink: document.getElementById('channel-link'),
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('search-btn'),
            channelAvatar: document.querySelector('.channel-avatar'),
            mobileMenuBtn: document.querySelector('.mobile-menu-btn'),
            navLinks: document.querySelector('.nav-links')
        };
        
        // Cache for storing fetched videos and channel info
        const videoCache = new Map();
        const channelInfoCache = new Map();
        
        // Channel ID của bạn
        const CHANNEL_ID = 'UCZ277N6aRiU1ivKjFyv-ZLg';
        
        // Cập nhật CORS Proxy URLs
        const CORS_PROXIES = [
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://corsproxy.io/?',
            'https://thingproxy.freeboard.io/fetch/'
        ];
        
        // Lấy proxy ngẫu nhiên
        function getRandomProxy() {
            return CORS_PROXIES[Math.floor(Math.random() * CORS_PROXIES.length)];
        }
        
        // Format số người đăng ký
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Parse YouTube XML
        function parseYouTubeXml(xmlText) {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                // Kiểm tra lỗi parse XML
                const parserError = xmlDoc.querySelector('parsererror');
                if (parserError) {
                    throw new Error('Lỗi khi phân tích XML');
                }
                
                const entries = xmlDoc.querySelectorAll('entry');
                const videos = [];
                
                entries.forEach(entry => {
                    try {
                        const videoIdElement = entry.querySelector('videoId');
                        const titleElement = entry.querySelector('title');
                        const publishedElement = entry.querySelector('published');
                        const descriptionElement = entry.querySelector('media\\:description');
                        const thumbnailElement = entry.querySelector('media\\:thumbnail');
                        
                        const videoId = videoIdElement?.textContent;
                        const title = titleElement?.textContent;
                        const published = publishedElement?.textContent;
                        const description = descriptionElement?.textContent || '';
                        const thumbnail = thumbnailElement?.getAttribute('url');
                        
                        if (videoId && title) {
                            videos.push({
                                id: videoId,
                                title: title,
                                published: published,
                                description: description,
                                thumbnail: thumbnail
                            });
                        }
                    } catch (e) {
                        console.error('Lỗi khi phân tích entry:', e);
                    }
                });
                
                return videos;
            } catch (error) {
                console.error('Lỗi khi parse XML:', error);
                return [];
            }
        }
        
        // Fetch channel info from YouTube RSS
        async function fetchChannelInfo() {
            try {
                const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${CHANNEL_ID}`;
                const proxyUrl = getRandomProxy();
                const response = await fetch(proxyUrl + encodeURIComponent(rssUrl));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                // Extract channel info
                const channelTitle = xmlDoc.querySelector('author > name')?.textContent || 'Kênh YouTube';
                const channelUrl = xmlDoc.querySelector('author > uri')?.textContent || `https://www.youtube.com/channel/${CHANNEL_ID}`;
                
                // Extract channel avatar
                const channelAvatar = `https://i.ytimg.com/i/${CHANNEL_ID}/hqdefault.jpg`;
                
                // Extract video count
                const videoCount = xmlDoc.querySelectorAll('entry').length;
                
                // Lấy số người đăng ký từ một nguồn khác
                let subscriberCount = 'N/A';
                try {
                    // Thử lấy số người đăng ký từ trang kênh
                    const channelPageUrl = `https://www.youtube.com/channel/${CHANNEL_ID}`;
                    const channelResponse = await fetch(getRandomProxy() + encodeURIComponent(channelPageUrl));
                    
                    if (channelResponse.ok) {
                        const htmlText = await channelResponse.text();
                        // Tìm kiếm số người đăng ký trong HTML
                        const subscriberMatch = htmlText.match(/"subscriberCountText":\s*{\s*"accessibility":\s*{\s*"accessibilityData":\s*{\s*"label":\s*"([\d,]+)\s*người đăng ký"/);
                        
                        if (subscriberMatch && subscriberMatch[1]) {
                            // Loại bỏ dấu phẩy và chuyển thành số
                            const count = parseInt(subscriberMatch[1].replace(/,/g, ''));
                            subscriberCount = formatNumber(count);
                        }
                    }
                } catch (error) {
                    console.error('Không thể lấy số người đăng ký:', error);
                }
                
                return {
                    title: channelTitle,
                    url: channelUrl,
                    avatar: channelAvatar,
                    videoCount: videoCount,
                    subscriberCount: subscriberCount,
                    description: 'Kênh YouTube về Pokemon Revolution Online'
                };
            } catch (error) {
                console.error('Error fetching channel info:', error);
                
                // Trả về thông tin mặc định nếu có lỗi
                return {
                    title: 'Kênh YouTube',
                    url: `https://www.youtube.com/channel/${CHANNEL_ID}`,
                    avatar: `https://i.ytimg.com/i/${CHANNEL_ID}/hqdefault.jpg`,
                    videoCount: 0,
                    subscriberCount: 'N/A',
                    description: 'Không thể tải thông tin kênh'
                };
            }
        }
        
        // Fetch videos with retry mechanism
        async function fetchVideosWithRetry(retryCount = 3) {
            for (let i = 0; i <= retryCount; i++) {
                try {
                    const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${CHANNEL_ID}`;
                    const proxyUrl = getRandomProxy();
                    const response = await fetch(proxyUrl + encodeURIComponent(rssUrl));
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const xmlText = await response.text();
                    
                    // Kiểm tra xem có phải là HTML không
                    if (xmlText.includes('<!DOCTYPE html>') || xmlText.includes('<html')) {
                        throw new Error('Nhận HTML thay vì XML');
                    }
                    
                    const videos = parseYouTubeXml(xmlText);
                    
                    if (videos.length > 0) {
                        // Cache the results
                        videoCache.set(CHANNEL_ID, videos);
                        return videos;
                    } else {
                        throw new Error('Không tìm thấy video nào');
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    
                    if (i === retryCount) {
                        // Nếu tất cả các lần thử đều thất bại, thử phương pháp dự phòng
                        return await fetchVideosFallback();
                    }
                    
                    // Wait before retrying with exponential backoff
                    await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, i)));
                }
            }
            
            return [];
        }
        
        // Phương pháp dự phòng để lấy video
        async function fetchVideosFallback() {
            try {
                // Tạo một số video mẫu dựa trên channel ID
                const videos = [
                    {
                        id: 'jNQXAC9IVRw',
                        title: 'Pokemon Revolution Online - Gameplay',
                        published: new Date().toISOString(),
                        description: 'Video về Pokemon Revolution Online',
                        thumbnail: `https://img.youtube.com/vi/jNQXAC9IVRw/mqdefault.jpg`
                    },
                    {
                        id: 'M7lc1UVf-VE',
                        title: 'Pokemon Revolution Online - Tutorial',
                        published: new Date().toISOString(),
                        description: 'Hướng dẫn chơi Pokemon Revolution Online',
                        thumbnail: `https://img.youtube.com/vi/M7lc1UVf-VE/mqdefault.jpg`
                    }
                ];
                
                // Cache the results
                videoCache.set(CHANNEL_ID, videos);
                
                return videos;
            } catch (error) {
                console.error('Fallback method also failed:', error);
                return [];
            }
        }
        
        // Display channel info
        function displayChannelInfo(channelInfo) {
            if (!channelInfo) return;
            
            // Update channel avatar
            elements.channelAvatar.innerHTML = `<img src="${channelInfo.avatar}" alt="${channelInfo.title}">`;
            
            // Update channel name
            elements.channelName.textContent = channelInfo.title;
            
            // Update channel stats
            const subscriberCountElement = elements.subscriberCount.querySelector('span');
            subscriberCountElement.textContent = `${channelInfo.subscriberCount} người đăng ký`;
            
            const videoCountElement = elements.videoCount.querySelector('span');
            videoCountElement.textContent = `${channelInfo.videoCount} video`;
            
            // Update channel description
            elements.channelDescription.textContent = channelInfo.description;
            
            // Update channel link
            elements.channelLink.href = channelInfo.url;
        }
        
        // Display featured video
        function displayFeaturedVideo(video) {
            const { id, title, description } = video;
            
            // Create iframe efficiently
            const iframe = document.createElement('iframe');
            iframe.src = `https://www.youtube.com/embed/${id}?rel=0&modestbranding=1`;
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.allowFullscreen = true;
            
            // Clear old content and add new iframe
            elements.featuredPlayer.innerHTML = '';
            elements.featuredPlayer.appendChild(iframe);
            
            // Update title and description
            elements.featuredTitle.textContent = title;
            elements.featuredDescription.textContent = description.substring(0, 150) + '...';
        }
        
        // Lazy load image
        function lazyLoadImage(imgElement, src) {
            imgElement.onload = function() {
                this.classList.add('loaded');
            };
            
            // Use requestAnimationFrame for performance optimization
            requestAnimationFrame(() => {
                imgElement.src = src;
            });
        }
        
        // Display video list with search filter
        function displayVideoList(videos, searchTerm = '') {
            // Clear old content
            elements.videoList.innerHTML = '';
            
            // Filter videos based on search term
            const filteredVideos = searchTerm 
                ? videos.filter(video => 
                    video.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    video.description.toLowerCase().includes(searchTerm.toLowerCase())
                  )
                : videos;
            
            if (filteredVideos.length === 0) {
                elements.videoList.innerHTML = '<div class="error-message">Không tìm thấy video nào phù hợp.</div>';
                return;
            }
            
            // Use document fragment to reduce reflow
            const fragment = document.createDocumentFragment();
            
            filteredVideos.forEach((video, index) => {
                const { id, title, published, thumbnail } = video;
                const thumbnailUrl = thumbnail || `https://img.youtube.com/vi/${id}/mqdefault.jpg`;
                const publishedAt = new Date(published).toLocaleDateString('vi-VN');
                
                const videoItem = document.createElement('div');
                videoItem.className = `video-item ${index === 0 ? 'active' : ''}`;
                videoItem.dataset.videoId = id;
                
                videoItem.innerHTML = `
                    <div class="video-thumbnail">
                        <img data-src="${thumbnailUrl}" alt="${title}">
                        <div class="video-duration">--:--</div>
                    </div>
                    <div class="video-info">
                        <h3>${title}</h3>
                        <p>${publishedAt}</p>
                    </div>
                `;
                
                fragment.appendChild(videoItem);
            });
            
            elements.videoList.appendChild(fragment);
            
            // Lazy load images after adding to DOM
            const images = elements.videoList.querySelectorAll('img[data-src]');
            images.forEach(img => {
                lazyLoadImage(img, img.dataset.src);
            });
        }
        
        // Show error message
        function showError(message) {
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message';
            errorElement.textContent = message;
            
            elements.featuredPlayer.innerHTML = '';
            elements.featuredPlayer.appendChild(errorElement.cloneNode(true));
            
            elements.videoList.innerHTML = '';
            elements.videoList.appendChild(errorElement);
        }
        
        // Event delegation for video items
        elements.videoList.addEventListener('click', function(event) {
            const videoItem = event.target.closest('.video-item');
            
            if (videoItem) {
                const videoId = videoItem.dataset.videoId;
                
                // Remove active class from all items
                document.querySelectorAll('.video-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Add active class to clicked item
                videoItem.classList.add('active');
                
                // Find video data from cache
                const videos = videoCache.get(CHANNEL_ID) || [];
                const video = videos.find(v => v.id === videoId);
                
                if (video) {
                    displayFeaturedVideo(video);
                }
            }
        });
        
        // Search functionality
        function performSearch() {
            const searchTerm = elements.searchInput.value.trim();
            const videos = videoCache.get(CHANNEL_ID) || [];
            
            displayVideoList(videos, searchTerm);
        }
        
        elements.searchBtn.addEventListener('click', performSearch);
        elements.searchInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        });
        
        // Subscribe button functionality
        elements.subscribeBtn.addEventListener('click', function() {
            const channelUrl = elements.channelLink.href;
            window.open(channelUrl, '_blank');
        });
        
        // Mobile menu functionality
        elements.mobileMenuBtn.addEventListener('click', function() {
            elements.navLinks.style.display = elements.navLinks.style.display === 'flex' ? 'none' : 'flex';
            elements.navLinks.style.position = 'absolute';
            elements.navLinks.style.top = '70px';
            elements.navLinks.style.right = '20px';
            elements.navLinks.style.flexDirection = 'column';
            elements.navLinks.style.backgroundColor = 'rgba(15, 15, 35, 0.9)';
            elements.navLinks.style.padding = '15px';
            elements.navLinks.style.borderRadius = '10px';
            elements.navLinks.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.3)';
            elements.navLinks.style.zIndex = '1000';
            
            // Reset styles when closing
            if (elements.navLinks.style.display === 'none') {
                setTimeout(() => {
                    elements.navLinks.style.position = '';
                    elements.navLinks.style.top = '';
                    elements.navLinks.style.right = '';
                    elements.navLinks.style.flexDirection = '';
                    elements.navLinks.style.backgroundColor = '';
                    elements.navLinks.style.padding = '';
                    elements.navLinks.style.borderRadius = '';
                    elements.navLinks.style.boxShadow = '';
                    elements.navLinks.style.zIndex = '';
                }, 300);
            }
        });
        
        // Initialize with async function
        async function init() {
            try {
                // Check cache first for channel info
                if (channelInfoCache.has(CHANNEL_ID)) {
                    displayChannelInfo(channelInfoCache.get(CHANNEL_ID));
                } else {
                    // Fetch channel info if not in cache
                    const channelInfo = await fetchChannelInfo();
                    if (channelInfo) {
                        channelInfoCache.set(CHANNEL_ID, channelInfo);
                        displayChannelInfo(channelInfo);
                    }
                }
                
                // Check cache for videos
                if (videoCache.has(CHANNEL_ID)) {
                    const videos = videoCache.get(CHANNEL_ID);
                    displayFeaturedVideo(videos[0]);
                    displayVideoList(videos);
                    return;
                }
                
                // Fetch videos if not in cache
                const videos = await fetchVideosWithRetry();
                
                if (videos.length > 0) {
                    displayFeaturedVideo(videos[0]);
                    displayVideoList(videos);
                } else {
                    showError('Không thể tải video từ kênh này. Vui lòng thử lại sau.');
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showError(`Lỗi khi tải video: ${error.message}`);
            }
        }
        
        // Start the application when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
        
        // Add Intersection Observer for lazy loading
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        const src = img.dataset.src;
                        
                        if (src) {
                            lazyLoadImage(img, src);
                            observer.unobserve(img);
                        }
                    }
                });
            });
            
            // Observe images with data-src attribute
            document.querySelectorAll('img[data-src]').forEach(img => {
                imageObserver.observe(img);
            });
        }
    </script>
</body>
</html>